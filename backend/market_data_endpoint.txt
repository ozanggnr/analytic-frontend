# ADD THIS TO main.py AFTER THE /api/stocks ENDPOINT

@app.get("/api/market-data")
def get_market_data():
    """
    Returns analyzed data for both BIST and GLOBAL stocks.
    This replaces the slow individual fetch approach.
    """
    results = []
    
    # Analyze BIST stocks
    print("Fetching BIST stocks...")
    for symbol in BIST_SYMBOLS[:50]:  # Limit to first 50 for speed
        try:
            data = analyze_stock(symbol, is_commodity=False)
            if data:
                results.append(data)
        except Exception as e:
            print(f"Error analyzing {symbol}: {e}")
            continue
    
    # Analyze GLOBAL stocks  
    print("Fetching GLOBAL stocks...")
    for symbol in GLOBAL_SYMBOLS[:50]:  # Limit to first 50 for speed
        try:
            data = analyze_stock(symbol, is_commodity=False)
            if data:
                results.append(data)
        except Exception as e:
            print(f"Error analyzing {symbol}: {e}")
            continue
    
    # Analyze Commodities
    print("Fetching Commodities...")
    for symbol in COMMODITIES_SYMBOLS.keys():
        try:
            data = analyze_stock(symbol, is_commodity=True)
            if data:
                results.append(data)
        except Exception as e:
            print(f"Error analyzing {symbol}: {e}")
            continue
    
    print(f"Total stocks analyzed: {len(results)}")
    return {"stocks": results}
